<html><head></head><body><p>Please, there must be a thousand ways to do this that I havenâ€™t discovered. If you know of anything simpler, Iâ€™m all ears. The following is a quick-and-dirty summary of how I did it.</p>

    <div class="admonition notify">
      <div class="admonition-header">
        <span>ðŸ‘‰ <strong>Update: SebastiÃ¡n to the rescue with his cdsync package</strong></span>
      </div>
      <div class="admonition-content">
        <p>Seb let me know about his package that does all this and more: <a href="https://git.sr.ht/~sebasmonia/cdsync.el">cdsync</a></p>
      </div>
    </div><p>I use the <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Diary.html">Emacs Diary</a> all the time. I prefer it to using only Org-mode dates in my agenda. The tricky piece is getting the stuff from my CalDAV (Fastmail) calendar into the diary.</p>
<p>Hannoâ€™s post, <a href="https://www.hoowl.se/khalel.html">Managing calendar events in Emacs</a> got me started. Their post is more geared toward Org dates, but it gave me a good leg up.</p>
<p>Basically, itâ€™s this:</p>
<ol>
<li>Sync using <a href="https://vdirsyncer.pimutils.org/en/stable/index.html">vdirsyncer</a></li>
<li>Convert using <a href="https://khal.readthedocs.io/en/latest/index.html">khal</a></li>
<li>Include converted entries in my diary file</li>
</ol>
<p>I installed vdirsyncer and khal via Pacman (Omarchy)</p>
<p>Hereâ€™s my <code>~/.config/vdirsyncer/config</code>:</p>
<pre><code>[general]
# A folder where vdirsyncer can store some metadata about each pair.
status_path = "~/.vdirsyncer/status/"

# CALDAV
[pair jack_calendar]
a = "jack_calendar_local"
b = "jack_calendar_remote"
collections = ["from a", "from b"]

# Calendars also have a color property
metadata = ["displayname", "color"]

[storage jack_calendar_local]
type = "filesystem"
path = "~/.calendars/"
fileext = ".ics"

[storage jack_calendar_remote]
type = "caldav"
url = "https://my.caldav.account"
username = "nerd@example.com"
password = "averylongpasswordreally"
</code></pre><p>I ran <code>vdirsyncer discover</code> once and then <code>vdirsyncer sync</code> and it pulled my calendars down into <code>~/.calendars/</code></p>
<p>vdirsyncer creates .ics calendar files, which arenâ€™t useful for Emacs Diary. Thatâ€™s where <a href="https://khal.readthedocs.io/en/latest/index.html">khal</a> comes in.</p>
<p>My <code>~/.config/khal/config</code> file:</p>
<pre><code>[calendars]

[[main]]

  path = "~/.calendars/699f44f9-799a-4325-9328-aff622023096/"
  color = dark green

[[other]]
  path = "~/.calendars/2e7d0c52-d5c7-4e6a-aa2e-01f8eb84a515/"

[locale]

  dateformat = %Y-%m-%d
  timeformat = %H:%M
</code></pre><p>That tells khal where the calenders are, and sets up a usable output format for use in the Emacs Diary. The following command is where I landed.</p>
<pre><code>khal list --format "{start-date} {start-time}-{end-time} {title}" \
      --day-format "" \
      today 10d &gt;~/.config/emacs-mine/caldav-diary
</code></pre><p>It generates a list of calendar events from today until 10 days from now and puts the results into a file that I use as part of my Emacs Diary. Just make sure that includes are enabled:</p>
<pre><code>(add-hook 'diary-list-entries-hook 'diary-include-other-diary-files)
</code></pre><p>Then, in my main diary files, I added the include line:</p>
<pre><code>#include "/home/jbaty/.config/emacs-mine/caldav-diary"
</code></pre><figure>
    <img loading="lazy" src="agenda.jpg#center" alt="Screenshot of my agenda"> <figcaption>
            <p>Events from CalDAV on my Org agenda</p>
        </figcaption>
</figure>

<p>And boom! My Fastmail calendar shows up in my Org Agenda.</p>
<p>Iâ€™m not worrying about syncing the other direction, yet.</p>
</body></html>